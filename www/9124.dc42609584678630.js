"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9124],{9124:(k,h,n)=>{n.r(h),n.d(h,{MisviajesPageModule:()=>P});var s=n(177),g=n(4341),o=n(4742),m=n(9384),v=n(467),i=n(3953),j=n(7770),u=n(9011),f=n(6378);function F(t,l){if(1&t){const e=i.RV6();i.j41(0,"div",6)(1,"ion-card")(2,"ion-card-header",7)(3,"ion-card-title"),i.EFF(4),i.nI1(5,"uppercase"),i.k0s(),i.nrm(6,"ion-icon",8),i.k0s(),i.j41(7,"ion-card-content",9)(8,"p"),i.EFF(9),i.nI1(10,"uppercase"),i.k0s(),i.j41(11,"p",10),i.EFF(12),i.k0s(),i.j41(13,"p",10),i.EFF(14),i.k0s(),i.j41(15,"p"),i.nrm(16,"ion-icon",11),i.EFF(17),i.nI1(18,"date"),i.k0s(),i.j41(19,"p"),i.nrm(20,"ion-icon",12),i.EFF(21),i.nI1(22,"date"),i.k0s(),i.nrm(23,"div",13),i.k0s(),i.j41(24,"ion-button",14),i.bIt("click",function(){const r=i.eBV(e).$implicit,c=i.XpG();return i.Njj(c.agregarHistorial({direccion:r.destino,precio:r.costo},r.costo,r.id))}),i.EFF(25," Terminar Viaje "),i.k0s(),i.j41(26,"ion-button",15),i.bIt("click",function(){const r=i.eBV(e).$implicit,c=i.XpG();return i.Njj(c.eliminarViaje(r.id))}),i.nrm(27,"ion-icon",16),i.EFF(28," Eliminar Viaje "),i.k0s()()()}if(2&t){const e=l.$implicit;i.R7$(4),i.JRh(i.bMT(5,8,e.destino)),i.R7$(5),i.SpI("Creado por: ",i.bMT(10,10,e.nombreCreador),""),i.R7$(3),i.SpI("Capacidad: ",e.capacidad,""),i.R7$(2),i.SpI("Costo: ",e.costo," CLP"),i.R7$(3),i.SpI("",i.i5U(18,12,e.horaSalida,"dd/MM/yyyy")," "),i.R7$(4),i.JRh(i.i5U(22,15,e.horaSalida,"HH:mm")),i.R7$(2),i.Mz_("id","map-",e.id,"")}}function I(t,l){1&t&&(i.j41(0,"div")(1,"p"),i.EFF(2,"No hay viajes en el historial."),i.k0s()())}function M(t,l){if(1&t&&(i.j41(0,"ion-list",3)(1,"p"),i.EFF(2),i.k0s(),i.j41(3,"p"),i.EFF(4),i.nI1(5,"currency"),i.k0s(),i.j41(6,"p"),i.EFF(7),i.nI1(8,"date"),i.k0s(),i.nrm(9,"hr"),i.k0s()),2&t){const e=l.$implicit;i.R7$(2),i.SpI("Direcci\xf3n: ",e.direccion,""),i.R7$(2),i.SpI("Precio: ",i.bMT(5,3,e.precio),""),i.R7$(3),i.SpI("Fecha: ",i.i5U(8,5,e.fecha,"medium"),"")}}const S=[{path:"",component:(()=>{class t{constructor(e,a,r){this.mapsService=e,this.databaseService=a,this.authService=r,this.viajes=[],this.currentUserId="",this.nombreCreador="",this.historial=[]}ngOnInit(){this.authService.getUser().subscribe(e=>{e&&(this.currentUserId=e.uid,this.cargarViajes(),this.cargarHistorial())}),this.initCurrentLocation()}cargarViajes(){this.databaseService.recuperarViajes().subscribe(e=>{this.viajes=e.filter(a=>a.usuarioId===this.currentUserId),this.refreshMaps()},e=>{console.error("Error al cargar viajes de Firestore:",e)})}refreshMaps(){this.mapsService.refreshMaps(this.viajes,this.currentLocation)}initCurrentLocation(){var e=this;return(0,v.A)(function*(){try{e.currentLocation=yield e.mapsService.getCurrentLocation(),e.mapsService.refreshMaps(e.viajes,e.currentLocation)}catch(a){console.error("Error al obtener la geolocalizaci\xf3n:",a)}})()}cargarHistorial(){const e=JSON.parse(localStorage.getItem("historial")||"[]");this.historial=e}agregarHistorial(e,a,r){const d={...e,id:this.generarIdUnico(),terminado:!0,fecha:(new Date).toISOString()},p=JSON.parse(localStorage.getItem("historial")||"[]");p.push(d),localStorage.setItem("historial",JSON.stringify(p)),this.incrementarViajesTerminados(a),this.eliminarViaje(r),this.cargarHistorial()}generarIdUnico(){return"historial_"+Date.now()+"_"+Math.floor(1e4*Math.random())}incrementarViajesTerminados(e){const a=parseInt(localStorage.getItem("viajesTerminados")||"0",10),r=parseInt(localStorage.getItem("ganancias")||"0",10);localStorage.setItem("viajesTerminados",(a+1).toString()),localStorage.setItem("ganancias",(r+e).toString())}eliminarViaje(e){this.databaseService.eliminarViaje(e).then(()=>{console.log("Viaje eliminado de Firestore:",e),this.cargarViajes()}).catch(a=>{console.error("Error al eliminar el viaje:",a)})}handleRefresh(e){setTimeout(()=>{window.location.reload(),e.target.complete()},300)}static{this.\u0275fac=function(a){return new(a||t)(i.rXU(j.D),i.rXU(u.B),i.rXU(f.P))}}static{this.\u0275cmp=i.VBU({type:t,selectors:[["app-misviajes"]],decls:9,vars:3,consts:[[1,"viajes-content"],["slot","fixed",3,"ionRefresh"],["class","viaje-card",4,"ngFor","ngForOf"],[1,"ion-padding"],[4,"ngIf"],["class","ion-padding",4,"ngFor","ngForOf"],[1,"viaje-card"],[1,"viaje-header"],["name","location","slot","start",1,"viaje-icon"],["mode","ios"],[1,"viaje-info"],["slot","start","name","calendar-outline",1,"mr-2"],["slot","start-outline","name","time",1,"mr-2"],[1,"map-container",3,"id"],["expand","block","mode","ios","fill","outline","color","success",3,"click"],["mode","ios","expand","block","fill","outline","color","danger",3,"click"],["name","trash","slot","start"]],template:function(a,r){1&a&&(i.j41(0,"ion-content",0)(1,"ion-refresher",1),i.bIt("ionRefresh",function(d){return r.handleRefresh(d)}),i.nrm(2,"ion-refresher-content"),i.k0s(),i.DNE(3,F,29,18,"div",2),i.j41(4,"div",3)(5,"h2"),i.EFF(6,"Historial de Viajes Terminados"),i.k0s(),i.DNE(7,I,3,0,"div",4)(8,M,10,8,"ion-list",5),i.k0s()()),2&a&&(i.R7$(3),i.Y8G("ngForOf",r.viajes),i.R7$(4),i.Y8G("ngIf",0===r.historial.length),i.R7$(),i.Y8G("ngForOf",r.historial))},dependencies:[s.Sq,s.bT,o.Jm,o.b_,o.I9,o.ME,o.tN,o.W9,o.iq,o.nf,o.To,o.Ki,s.Pc,s.oe,s.vh],styles:[".viajes-content[_ngcontent-%COMP%]{background-color:#f2f2f2;padding:15px}.viaje-card[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{border-radius:15px;box-shadow:0 4px 6px #0000001a;margin-bottom:15px}.viaje-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.viaje-icon[_ngcontent-%COMP%]{font-size:24px;color:#fa0}.viaje-info[_ngcontent-%COMP%]{margin:0;font-size:16px;color:#333;line-height:1.5}.map-container[_ngcontent-%COMP%]{width:100%;height:200px;border-radius:10px;margin-top:10px;background-color:#e0e0e0}ion-button[_ngcontent-%COMP%]{margin-top:15px;--border-radius: 10px;--background: #ff4d4f;--border-color: #ff4d4f;--color: white}"]})}}return t})()}];let b=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=i.$C({type:t})}static{this.\u0275inj=i.G2t({imports:[m.iI.forChild(S),m.iI]})}}return t})(),P=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=i.$C({type:t})}static{this.\u0275inj=i.G2t({imports:[s.MD,g.YN,o.bv,b]})}}return t})()}}]);