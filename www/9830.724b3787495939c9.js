"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9830],{9830:(F,h,c)=>{c.r(h),c.d(h,{NotificacionesPageModule:()=>v});var r=c(177),u=c(4341),o=c(4742),f=c(9384),e=c(3953),g=c(8079),d=c(6378),m=c(9011);function p(n,l){if(1&n&&(e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.EFF(4),e.k0s()(),e.j41(5,"ion-card-content")(6,"p"),e.EFF(7),e.k0s(),e.j41(8,"small"),e.EFF(9),e.nI1(10,"date"),e.k0s()()()()),2&n){const i=l.$implicit;e.R7$(4),e.JRh(i.sender),e.R7$(3),e.JRh(i.content),e.R7$(2),e.JRh(e.i5U(10,3,i.timestamp,"short"))}}function b(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Chat"),e.k0s(),e.j41(4,"ion-buttons",7)(5,"ion-button",4),e.bIt("click",function(){e.eBV(i);const s=e.XpG(2);return e.Njj(s.setOpen(!1))}),e.EFF(6,"Close"),e.k0s()()()(),e.j41(7,"ion-content",2),e.DNE(8,p,11,6,"div",1),e.j41(9,"ion-item")(10,"ion-input",8),e.mxI("ngModelChange",function(s){e.eBV(i);const a=e.XpG(2);return e.DH7(a.newMessage,s)||(a.newMessage=s),e.Njj(s)}),e.k0s(),e.j41(11,"ion-button",4),e.bIt("click",function(){e.eBV(i);const s=e.XpG(2);return e.Njj(s.sendMessage())}),e.EFF(12,"Enviar"),e.k0s()()()}if(2&n){const i=e.XpG(2);e.R7$(8),e.Y8G("ngForOf",i.messages),e.R7$(2),e.R50("ngModel",i.newMessage)}}function _(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-content")(1,"ion-card")(2,"ion-list")(3,"ion-label")(4,"ion-card-header")(5,"ion-card-subtitle"),e.EFF(6),e.k0s()(),e.j41(7,"ion-card-content")(8,"p"),e.EFF(9),e.k0s()(),e.j41(10,"p",2)(11,"small"),e.EFF(12),e.nI1(13,"date"),e.k0s()()(),e.j41(14,"div",2)(15,"ion-button",3),e.bIt("click",function(){const s=e.eBV(i).$implicit,a=e.XpG();return e.Njj(a.eliminarNotificacion(s.viajeId))}),e.EFF(16,"Eliminar Notificaci\xf3n"),e.k0s(),e.j41(17,"ion-button",4),e.bIt("click",function(){e.eBV(i);const s=e.XpG();return e.Njj(s.setOpen(!0))}),e.nrm(18,"ion-icon",5),e.k0s()(),e.j41(19,"ion-modal",6),e.DNE(20,b,13,2,"ng-template"),e.k0s()()()()}if(2&n){const i=l.$implicit,t=e.XpG();e.R7$(6),e.JRh(i.tipo),e.R7$(3),e.JRh(i.mensaje),e.R7$(3),e.JRh(e.bMT(13,4,null==i.fecha?null:i.fecha.toDate())),e.R7$(7),e.Y8G("isOpen",t.isModalOpen)}}const N=[{path:"",component:(()=>{class n{constructor(i,t,s,a){this.firestore=i,this.authService=t,this.firebaseStorage=s,this.modalController=a,this.usuarioId="",this.currentUserId="",this.currentUserName="",this.chatId="chatTellevo",this.messages=[],this.newMessage="",this.isModalOpen=!1}ngOnInit(){this.userSubscription=this.authService.getUser().subscribe(i=>{i?(this.usuarioId=i.uid,console.log("Usuario ID:",this.usuarioId),this.cargarViajesYNotificaciones()):console.log("Usuario no autenticado")}),console.log("notificacion",this.cargarViajesYNotificaciones()),this.authService.getUser().subscribe({next:i=>{i&&(this.currentUserId=i.uid)},error:i=>{console.error("Error al obtener el usuario:",i)}}),this.messagesSubscription=this.firebaseStorage.getMessages(this.chatId).subscribe(i=>{this.messages=i}),this.firebaseStorage.obtenerNombreUsuarioActual().subscribe({next:i=>{this.currentUserName=i,console.log("Nombre del usuario:",this.currentUserName)},error:i=>{console.error("Error al obtener el nombre del usuario:",i)}})}cargarViajesYNotificaciones(){console.log("Cargando viajes y notificaciones..."),this.viajes$=this.firestore.collection("viajes",i=>i.where("usuarioId","==",this.usuarioId).where("fecha",">=",new Date).orderBy("fecha")).valueChanges(),this.notificaciones$=this.firestore.collection("notificaciones",i=>i.where("usuarioId","==",this.usuarioId).orderBy("fecha","desc")).valueChanges(),this.notificaciones$.subscribe(i=>{0===i.length?console.log("No se encontraron notificaciones."):console.log("Notificaciones recibidas:",i)})}eliminarNotificacion(i){this.firestore.collection("notificaciones",t=>t.where("viajeId","==",i)).get().subscribe(t=>{t.empty?console.log("No se encontraron notificaciones para eliminar."):t.forEach(s=>{s.ref.delete().then(()=>{console.log("Notificaci\xf3n de reserva eliminada.")}).catch(a=>{console.error("Error al eliminar la notificaci\xf3n de reserva:",a)})})})}setOpen(i){this.isModalOpen=i}sendMessage(){if(""!==this.newMessage.trim()){const i={sender:this.currentUserName,content:this.newMessage,timestamp:(new Date).getTime()};this.firebaseStorage.sendMessage(this.chatId,i).then(()=>{this.newMessage=""}).catch(t=>console.error("Error al enviar el mensaje:",t))}}ngOnDestroy(){this.messagesSubscription&&this.messagesSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||n)(e.rXU(g.Qe),e.rXU(d.P),e.rXU(m.B),e.rXU(o.W3))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-notificaciones"]],decls:6,vars:3,consts:[["color","primary"],[4,"ngFor","ngForOf"],[1,"ion-padding"],["color","danger",3,"click"],[3,"click"],["name","chatbubbles-outline"],[3,"isOpen"],["slot","end"],["placeholder","Escribe un mensaje",3,"ngModelChange","ngModel"]],template:function(t,s){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Notificaciones"),e.k0s()()(),e.DNE(4,_,21,6,"ion-content",1),e.nI1(5,"async")),2&t&&(e.R7$(4),e.Y8G("ngForOf",e.bMT(5,1,s.notificaciones$)))},dependencies:[r.Sq,u.BC,u.vS,o.Jm,o.QW,o.b_,o.I9,o.ME,o.HW,o.tN,o.W9,o.eU,o.iq,o.$w,o.uz,o.he,o.nf,o.BC,o.ai,o.Sb,o.Gw,r.Jj,r.vh]})}}return n})()}];let j=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[f.iI.forChild(N),f.iI]})}}return n})(),v=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[r.MD,u.YN,o.bv,j]})}}return n})()}}]);