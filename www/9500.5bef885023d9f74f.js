"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9500],{9500:(j,l,s)=>{s.r(l),s.d(l,{ConductorPageModule:()=>C});var p=s(177),d=s(4341),i=s(4742),u=s(9384),g=s(467),e=s(3953),h=s(7770),m=s(6378),f=s(9011);const b=[{path:"",component:(()=>{class a{constructor(t,r,o,c,n){this.mapsService=t,this.loadingController=r,this.authService=o,this.databaseService=c,this.alertCtrl=n,this.tieneVehiculo=!1,this.userId=null,this.usuarioId=null,this.vje={id:Date.now(),destino:"",capacidad:0,costo:0,horaSalida:"",lat:0,lng:0,usuarioId:""},this.viajes=[],this.marker=null,this.currentUserName=""}ngOnInit(){this.initCurrentLocation(),this.obtenerUsuarioId(),console.log(this.databaseService.obtenerUsuarios(),"aqui"),this.databaseService.obtenerNombreUsuarioActual().subscribe({next:t=>{this.currentUserName=t,console.log("Nombre del usuario:",this.currentUserName)},error:t=>{console.error("Error al obtener el nombre del usuario:",t)}})}initCurrentLocation(){var t=this;return(0,g.A)(function*(){try{t.currentLocation=yield t.mapsService.getCurrentLocation(),t.initMap()}catch(r){console.error("Error al obtener la ubicaci\xf3n actual:",r)}})()}obtenerUsuarioId(){this.authService.getUser().subscribe(t=>{t?(this.usuarioId=t.uid,console.log("ID del usuario:",this.usuarioId)):console.log("No hay usuario autenticado")})}initMap(){this.currentLocation&&(this.map=this.mapsService.initMap("map",this.currentLocation.lat,this.currentLocation.lng))}programarViaje(){var t=this;return(0,g.A)(function*(){const r=yield t.loadingController.create({message:"Creando direcci\xf3n..."});if(yield r.present(),!t.usuarioId)return console.error("El ID del usuario es null. No se puede crear el viaje."),void(yield r.dismiss());t.vje.usuarioId=t.usuarioId,t.vje.nombreCreador=t.currentUserName;const o=localStorage.getItem("viajes");let c=o?JSON.parse(o):[];t.vje.id=Date.now();try{const n=yield t.mapsService.getLatLngFromAddress(t.vje.destino);t.vje.lat=n.lat,t.vje.lng=n.lng,yield t.databaseService.agregarViaje(t.vje),console.log("Viaje guardado en Firestore:",t.vje),t.viajes=c,t.mapsService.refreshMaps(t.viajes,t.currentLocation)}catch(n){console.error("Error al crear la direcci\xf3n:",n)}finally{yield r.dismiss()}})()}onDestinoChange(){this.marker&&this.map?.removeLayer(this.marker),this.vje.destino&&this.mapsService.getLatLngFromAddress(this.vje.destino).then(t=>{this.vje.lat=t.lat,this.vje.lng=t.lng,this.marker=this.mapsService.addMarker(this.map,t.lat,t.lng),this.mapsService.drawRoute(this.map,this.currentLocation.lat,this.currentLocation.lng,t.lat,t.lng)}).catch(t=>{console.error("Error al obtener la ubicaci\xf3n del destino:",t)})}static{this.\u0275fac=function(r){return new(r||a)(e.rXU(h.D),e.rXU(i.Xi),e.rXU(m.P),e.rXU(f.B),e.rXU(i.hG))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-conductor"]],decls:14,vars:4,consts:[["color","primary","id","alertButtons"],["id","map",2,"height","100%"],[1,"travel-form"],[3,"ngSubmit"],["name","destino","type","text","placeholder","Destino",3,"ngModelChange","ngModel"],["name","capacidad","type","number","label","Capacidad",3,"ngModelChange","ngModel"],["name","costo","type","number","label","Costo",3,"ngModelChange","ngModel"],["name","horaSalida","presentation","time","placeholder","Seleccionar hora","cancel-text","Cancelar","done-text","Hecho","hour-cycle","h23",3,"ngModelChange","ngModel"],["expand","block","color","primary","type","submit"]],template:function(r,o){1&r&&(e.j41(0,"ion-content",0),e.nrm(1,"div",1),e.qex(2),e.j41(3,"ion-card",2)(4,"form",3),e.bIt("ngSubmit",function(){return o.programarViaje()}),e.j41(5,"ion-card-content")(6,"ion-input",4),e.mxI("ngModelChange",function(n){return e.DH7(o.vje.destino,n)||(o.vje.destino=n),n}),e.k0s(),e.j41(7,"ion-input",5),e.mxI("ngModelChange",function(n){return e.DH7(o.vje.capacidad,n)||(o.vje.capacidad=n),n}),e.k0s(),e.j41(8,"ion-input",6),e.mxI("ngModelChange",function(n){return e.DH7(o.vje.costo,n)||(o.vje.costo=n),n}),e.k0s(),e.j41(9,"ion-label"),e.EFF(10,"Hora de salida"),e.k0s(),e.j41(11,"ion-datetime",7),e.mxI("ngModelChange",function(n){return e.DH7(o.vje.horaSalida,n)||(o.vje.horaSalida=n),n}),e.k0s(),e.j41(12,"ion-button",8),e.EFF(13," Registrar viaje "),e.k0s()()()(),e.bVm(),e.k0s()),2&r&&(e.R7$(6),e.R50("ngModel",o.vje.destino),e.R7$(),e.R50("ngModel",o.vje.capacidad),e.R7$(),e.R50("ngModel",o.vje.costo),e.R7$(3),e.R50("ngModel",o.vje.horaSalida))},dependencies:[d.qT,d.BC,d.cb,d.vS,d.cV,i.Jm,i.b_,i.I9,i.W9,i.A9,i.$w,i.he,i.su,i.Je,i.Gw],styles:['@charset "UTF-8";ion-card.custom-card[_ngcontent-%COMP%]{margin:20px 5px;padding:15px;box-shadow:0 4px 8px #0003;border-radius:12px;border:1px solid #e0e0e0;min-height:300px;transform:translateY(-20px);transition:opacity .5s ease,transform .5s ease}ion-card.custom-card[_ngcontent-%COMP%]:hover{transform:scale(1.03);box-shadow:0 6px 12px #0000004d}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.card-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#fff;margin:0}.card-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#fff;margin:5px 0}#map[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:1}.travel-form[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:10px;right:10px;background:#ffffffe6;border-radius:10px;box-shadow:0 2px 10px #0000004d;padding:20px;z-index:2}ion-card-content[_ngcontent-%COMP%]{padding:20px}ion-button.delete-btn[_ngcontent-%COMP%]{margin-top:15px;border-radius:8px;padding:12px;font-size:.9rem;font-weight:500;transition:background-color .3s ease-in-out,box-shadow .3s ease-in-out;width:100%;display:flex;justify-content:center;align-items:center;box-shadow:none}ion-button.delete-btn[_ngcontent-%COMP%]:hover{box-shadow:0 4px 6px #0000001a}ion-button.delete-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}.custom-card.loaded[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.custom-card.removing[_ngcontent-%COMP%]{opacity:0;transform:translateY(20px);transition:opacity .5s ease,transform .5s ease}label[_ngcontent-%COMP%]{font-size:16px;margin-bottom:8px;color:#333;font-weight:500}input[type=time][_ngcontent-%COMP%]{width:100%;padding:12px;font-size:16px;background-color:#f2f2f7;border:1px solid #d1d1d6;border-radius:10px;color:#333;box-sizing:border-box;outline:none;appearance:none;transition:border-color .3s ease-in-out}input[type=time][_ngcontent-%COMP%]:focus{border-color:#007aff}input[type=time][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(50%);opacity:.5}']})}}return a})()}];let v=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[u.iI.forChild(b),u.iI]})}}return a})(),C=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[p.MD,d.YN,i.bv,v]})}}return a})()}}]);